<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forgot Password - Barangay North Signal Village</title>
  <link rel="stylesheet" href="../CSS/Admin-login.css">
  <link rel="stylesheet" href="../CSS/admin-forgot-password.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="page-container">
    <!-- Header -->
    <header class="header">
      <div class="brgy-info">
        <img src="../IMG/Logo.png" alt="Barangay Logo" class="brgy-logo">
        <div class="brgy-details">
          <h1>Barangay North Signal Village</h1>
          <p>Ipil - Ipil St North Signal Village 1636 Taguig, Philippines</p>
        </div>
      </div>
      
      <div class="user-icon">
        <i class="fas fa-user"></i>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Step 1: Request Password Reset -->
      <div id="request-reset" class="forgot-password-container">
        <div class="login-header">
          <div class="login-icon">
            <i class="fas fa-key"></i>
          </div>
          <h2>Forgot Password?</h2>
          <p class="subtitle">Enter your email to receive a password reset link</p>
        </div>
        
        <form id="request-form" class="forgot-password-form">
          <div class="form-group">
            <div class="input-icon">
              <i class="fas fa-envelope"></i>
            </div>
            <input type="email" id="email" placeholder="Email" required>
            <label for="email" class="floating-label">Email</label>
          </div>
          
          <!-- CAPTCHA Section -->
          <div class="captcha-container">
            <div class="captcha-box">
              <span id="captcha-text">XB4F9Z</span>
              <button type="button" id="refresh-captcha" aria-label="Refresh captcha">
                <i class="fas fa-sync-alt"></i>
              </button>
            </div>
            <div class="form-group">
              <div class="input-icon">
                <i class="fas fa-shield-alt"></i>
              </div>
              <input type="text" id="captcha-input" placeholder="Enter captcha" required>
              <label for="captcha-input" class="floating-label">Enter captcha</label>
            </div>
          </div>
          
          <div id="request-error" class="error-message">
            <i class="fas fa-exclamation-circle"></i>
            <span>Error message will appear here</span>
          </div>
          
          <div class="form-actions">
            <button type="submit" id="request-btn" class="confirm-btn">
              <span>Send Reset Link</span>
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
          
          <div class="back-to-login">
            <a href="../HTML/Admin-login.html">Back to Login</a>
          </div>
        </form>
      </div>
      
      <!-- Step 2: Reset Password (Initially Hidden) -->
      <div id="reset-password" class="forgot-password-container" style="display: none;">
        <div class="login-header">
          <div class="login-icon">
            <i class="fas fa-lock-open"></i>
          </div>
          <h2>Reset Password</h2>
          <p class="subtitle">Create a new secure password</p>
        </div>
        
        <form id="reset-form" class="forgot-password-form">
          <input type="hidden" id="reset-token" value="">
          
          <div class="form-group">
            <div class="input-icon">
              <i class="fas fa-lock"></i>
            </div>
            <input type="password" id="new-password" placeholder="New Password" required minlength="8">
            <label for="new-password" class="floating-label">New Password</label>
            <button type="button" class="toggle-password" aria-label="Toggle password visibility" data-target="new-password">
              <i class="fas fa-eye"></i>
            </button>
          </div>
          
          <div class="password-requirements">
            <p>Password must contain:</p>
            <ul>
              <li id="length-check"><i class="fas fa-times-circle"></i> At least 8 characters</li>
              <li id="uppercase-check"><i class="fas fa-times-circle"></i> At least 1 uppercase letter</li>
              <li id="lowercase-check"><i class="fas fa-times-circle"></i> At least 1 lowercase letter</li>
              <li id="number-check"><i class="fas fa-times-circle"></i> At least 1 number</li>
              <li id="special-check"><i class="fas fa-times-circle"></i> At least 1 special character</li>
            </ul>
          </div>
          
          <div class="password-strength-container">
            <div class="password-strength-label">
              <span>Password Strength:</span>
              <span id="strength-text">Weak</span>
            </div>
            <div class="password-strength-bar">
              <div id="strength-indicator" class="password-strength weak"></div>
            </div>
          </div>
          
          <div class="form-group">
            <div class="input-icon">
              <i class="fas fa-lock"></i>
            </div>
            <input type="password" id="confirm-password" placeholder="Confirm Password" required>
            <label for="confirm-password" class="floating-label">Confirm Password</label>
            <button type="button" class="toggle-password" aria-label="Toggle password visibility" data-target="confirm-password">
              <i class="fas fa-eye"></i>
            </button>
          </div>
          
          <div id="reset-error" class="error-message">
            <i class="fas fa-exclamation-circle"></i>
            <span>Error message will appear here</span>
          </div>
          
          <div class="form-actions">
            <button type="submit" id="reset-btn" class="confirm-btn">
              <span>Reset Password</span>
              <i class="fas fa-check"></i>
            </button>
          </div>
        </form>
      </div>
      
      <!-- Success Message (Initially Hidden) -->
      <div id="success-message" class="forgot-password-container success-container" style="display: none;">
        <div class="success-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h2>Success!</h2>
        <p id="success-text">Your password has been reset successfully.</p>
        <div class="form-actions">
          <a href="../HTML/Admin-login.html" class="confirm-btn">
            <span>Back to Login</span>
            <i class="fas fa-sign-in-alt"></i>
          </a>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-content">
        <div class="footer-text">
          <p>Barangay North Signal Village</p>
        </div>
        
        <div class="footer-logos">
          <img src="../IMG/Logo.png" alt="Logo 1" class="footer-logo">
          <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/ce17a13d946f45d4463799aecacbd180eeb462fe" alt="Logo 2" class="footer-logo">
        </div>
      </div>
    </footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // DOM Elements
      const requestResetDiv = document.getElementById('request-reset');
      const resetPasswordDiv = document.getElementById('reset-password');
      const successMessageDiv = document.getElementById('success-message');
      const requestForm = document.getElementById('request-form');
      const resetForm = document.getElementById('reset-form');
      const requestError = document.getElementById('request-error');
      const resetError = document.getElementById('reset-error');
      const newPasswordInput = document.getElementById('new-password');
      const confirmPasswordInput = document.getElementById('confirm-password');
      const strengthIndicator = document.getElementById('strength-indicator');
      const strengthText = document.getElementById('strength-text');
      const captchaText = document.getElementById('captcha-text');
      const refreshCaptchaBtn = document.getElementById('refresh-captcha');
      const successText = document.getElementById('success-text');
      
      // Password requirement checks
      const lengthCheck = document.getElementById('length-check');
      const uppercaseCheck = document.getElementById('uppercase-check');
      const lowercaseCheck = document.getElementById('lowercase-check');
      const numberCheck = document.getElementById('number-check');
      const specialCheck = document.getElementById('special-check');
      
      // Password toggle buttons
      const togglePasswordBtns = document.querySelectorAll('.toggle-password');
      
      // Hide error messages initially
      requestError.style.display = 'none';
      resetError.style.display = 'none';
      
      // Check URL for reset token
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get('token');
      
      if (token) {
        // If token exists in URL, show reset password form
        document.getElementById('reset-token').value = token;
        requestResetDiv.style.display = 'none';
        resetPasswordDiv.style.display = 'block';
      }
      
      // Generate random captcha
      function generateCaptcha() {
        const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
        let captcha = '';
        for (let i = 0; i < 6; i++) {
          captcha += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        captchaText.textContent = captcha;
      }
      
      // Generate initial captcha
      generateCaptcha();
      
      // Refresh captcha when button is clicked
      refreshCaptchaBtn.addEventListener('click', function(e) {
        e.preventDefault();
        generateCaptcha();
      });
      
      // Password visibility toggle
      togglePasswordBtns.forEach(btn => {
        btn.addEventListener('click', function() {
          const targetId = this.getAttribute('data-target');
          const passwordInput = document.getElementById(targetId);
          
          if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            this.querySelector('i').classList.remove('fa-eye');
            this.querySelector('i').classList.add('fa-eye-slash');
          } else {
            passwordInput.type = 'password';
            this.querySelector('i').classList.remove('fa-eye-slash');
            this.querySelector('i').classList.add('fa-eye');
          }
        });
      });
      
      // Password strength checker
      newPasswordInput.addEventListener('input', function() {
        const password = this.value;
        let strength = 0;
        
        // Update requirement checks
        if (password.length >= 8) {
          lengthCheck.innerHTML = '<i class="fas fa-check-circle"></i> At least 8 characters';
          lengthCheck.classList.add('met');
          strength += 1;
        } else {
          lengthCheck.innerHTML = '<i class="fas fa-times-circle"></i> At least 8 characters';
          lengthCheck.classList.remove('met');
        }
        
        if (/[A-Z]/.test(password)) {
          uppercaseCheck.innerHTML = '<i class="fas fa-check-circle"></i> At least 1 uppercase letter';
          uppercaseCheck.classList.add('met');
          strength += 1;
        } else {
          uppercaseCheck.innerHTML = '<i class="fas fa-times-circle"></i> At least 1 uppercase letter';
          uppercaseCheck.classList.remove('met');
        }
        
        if (/[a-z]/.test(password)) {
          lowercaseCheck.innerHTML = '<i class="fas fa-check-circle"></i> At least 1 lowercase letter';
          lowercaseCheck.classList.add('met');
          strength += 1;
        } else {
          lowercaseCheck.innerHTML = '<i class="fas fa-times-circle"></i> At least 1 lowercase letter';
          lowercaseCheck.classList.remove('met');
        }
        
        if (/[0-9]/.test(password)) {
          numberCheck.innerHTML = '<i class="fas fa-check-circle"></i> At least 1 number';
          numberCheck.classList.add('met');
          strength += 1;
        } else {
          numberCheck.innerHTML = '<i class="fas fa-times-circle"></i> At least 1 number';
          numberCheck.classList.remove('met');
        }
        
        if (/[^A-Za-z0-9]/.test(password)) {
          specialCheck.innerHTML = '<i class="fas fa-check-circle"></i> At least 1 special character';
          specialCheck.classList.add('met');
          strength += 1;
        } else {
          specialCheck.innerHTML = '<i class="fas fa-times-circle"></i> At least 1 special character';
          specialCheck.classList.remove('met');
        }
        
        // Update strength indicator
        strengthIndicator.className = 'password-strength';
        if (strength < 2) {
          strengthIndicator.classList.add('weak');
          strengthText.textContent = 'Weak';
          strengthText.style.color = '#ff3b3b';
        } else if (strength < 4) {
          strengthIndicator.classList.add('medium');
          strengthText.textContent = 'Medium';
          strengthText.style.color = '#ffeb3b';
        } else {
          strengthIndicator.classList.add('strong');
          strengthText.textContent = 'Strong';
          strengthText.style.color = '#3bff72';
        }
      });
      
      // Request password reset form submission
      requestForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const email = document.getElementById('email').value;
        const captchaInput = document.getElementById('captcha-input').value;
        
        // Validate captcha
        if (captchaInput !== captchaText.textContent) {
          requestError.innerHTML = '<i class="fas fa-exclamation-circle"></i> Invalid captcha. Please try again.';
          requestError.style.display = 'flex';
          generateCaptcha();
          document.getElementById('captcha-input').value = '';
          return;
        }
        
        // Simulate API call to request password reset
        // In a real application, this would send a request to the server
        
        // Show loading state
        const requestBtn = document.getElementById('request-btn');
        requestBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
        requestBtn.disabled = true;
        
        // Simulate server delay
        setTimeout(() => {
          // Check if email exists (for demo, we'll assume admin@example.com exists)
          if (email === 'admin@example.com') {
            // Show success message
            requestResetDiv.style.display = 'none';
            successMessageDiv.style.display = 'block';
            successText.textContent = 'A password reset link has been sent to your email. Please check your inbox.';
          } else {
            // Show error for non-existent email
            requestError.innerHTML = '<i class="fas fa-exclamation-circle"></i> Email not found in our records.';
            requestError.style.display = 'flex';
            requestBtn.innerHTML = '<span>Send Reset Link</span><i class="fas fa-paper-plane"></i>';
            requestBtn.disabled = false;
            generateCaptcha();
            document.getElementById('captcha-input').value = '';
          }
        }, 2000);
      });
      
      // Reset password form submission
      resetForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const newPassword = newPasswordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        const token = document.getElementById('reset-token').value;
        
        // Validate password requirements
        const isLengthValid = newPassword.length >= 8;
        const isUppercaseValid = /[A-Z]/.test(newPassword);
        const isLowercaseValid = /[a-z]/.test(newPassword);
        const isNumberValid = /[0-9]/.test(newPassword);
        const isSpecialValid = /[^A-Za-z0-9]/.test(newPassword);
        
        if (!(isLengthValid && isUppercaseValid && isLowercaseValid && isNumberValid && isSpecialValid)) {
          resetError.innerHTML = '<i class="fas fa-exclamation-circle"></i> Password does not meet all requirements.';
          resetError.style.display = 'flex';
          return;
        }
        
        // Validate passwords match
        if (newPassword !== confirmPassword) {
          resetError.innerHTML = '<i class="fas fa-exclamation-circle"></i> Passwords do not match.';
          resetError.style.display = 'flex';
          return;
        }
        
        // Validate token (in a real app, this would be validated on the server)
        if (!token) {
          resetError.innerHTML = '<i class="fas fa-exclamation-circle"></i> Invalid or expired reset token.';
          resetError.style.display = 'flex';
          return;
        }
        
        // Show loading state
        const resetBtn = document.getElementById('reset-btn');
        resetBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Resetting...';
        resetBtn.disabled = true;
        
        // Simulate API call to reset password
        // In a real application, this would send a request to the server
        
        // Simulate server delay
        setTimeout(() => {
          // Show success message
          resetPasswordDiv.style.display = 'none';
          successMessageDiv.style.display = 'block';
          successText.textContent = 'Your password has been reset successfully. You can now log in with your new password.';
        }, 2000);
      });
      
      // Add active class to form inputs when they have content
      const formInputs = document.querySelectorAll('.form-group input');
      formInputs.forEach(input => {
        input.addEventListener('input', function() {
          if (this.value.length > 0) {
            this.classList.add('has-content');
          } else {
            this.classList.remove('has-content');
          }
        });
      });
    });
  </script>
</body>
</html>