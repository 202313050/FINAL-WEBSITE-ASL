<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Barangay Clearance Form</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500&family=Poppins:wght@400;700&family=Roboto:wght@400;500&family=Noto+Sans:wght@400;600&family=Inter:wght@400&family=Lisu+Bosa:wght@900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../CSS/clearanceproof.css" />
  </head>
  <body>
    <div class="page-container">
      <div class="announcement-bar">
        <p class="announcement-text">
          Open Hours of Barangay North Signal Village [Day &amp; Time]
        </p>
        <a href="../HTML/Admin-login.html" class="login-text">LOGIN</a>
      </div>

      <header class="main-header">
        <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/4848c1b44e47c6c0ce74516fefca71bf5244d214" alt="Logo" class="header-logo" />
        <div class="header-info">
          <h1 class="header-title">Barangay North Signal Village</h1>
          <p class="header-address">
            Ipil-Ipil St, North Signal Village, Taguig 1636, Philippines
          </p>
        </div>
        <nav class="main-nav">
          <a href="../HTML/Home.html" class="nav-link">HOME</a>
          <a href="../HTML/About.html" class="nav-link">ABOUT</a>
          <div class="dropdown">
            <a href="#" class="nav-link dropdown-toggle">SERVICES <span class="dropdown-icon">â–¼</span></a>
            <div class="dropdown-content">
              <a href="../HTML/Business-Clearance.html">Business Clearance</a>
              <a href="../HTML/Form.html">Certificate</a>
              <a href="../HTML/Form.html">Clearances</a>
              <a href="../HTML/Brgyid.html">Business ID Application</a>
            </div>
          </div>
          <a href="../HTML/Contact.html" class="nav-link">CONTACT</a>
          <a href="../HTML/faq.html" class="nav-link">FAQ</a>
        </nav>
      </header>

      <div class="header-background">
        <svg width="1448" height="314" viewBox="0 0 1448 314" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g filter="url(#filter0_d_339_89)">
            <path d="M4 0H1444V306H4V0Z" fill="#0F2D70" />
          </g>
          <defs>
            <filter id="filter0_d_339_89" x="0" y="0" width="1448" height="314" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
              <feFlood flood-opacity="0" result="BackgroundImageFix" />
              <feColorMatrix in="SourceAlpha" type="matrix"
                values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
              <feOffset dy="4" />
              <feGaussianBlur stdDeviation="2" />
              <feComposite in2="hardAlpha" operator="out" />
              <feColorMatrix type="matrix"
                values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
              <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_339_89" />
              <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_339_89" result="shape" />
            </filter>
          </defs>
        </svg>
      </div>

        <!-- Header Line -->
<div class="header-line">
  <hr class="yellow-line">
</div>


      <main class="main-content">
        <h2 class="page-title">Clearance/Certificate</h2>

        <div class="progress-steps">
          <div class="step">
            <div class="step-number">1</div>
            <div class="step-label">Purpose & Document Type</div>
          </div>
          <div class="step">
            <div class="step-number">2</div>
            <div class="step-label">Form</div>
          </div>
          <div class="step active">
            <div class="step-number">3</div>
            <div class="step-label">Proof</div>
          </div>
        </div>

        <section class="form-container">

          <div class="form-field">
            <label class="form-label">Required Documents</label>
            <ul class="requirements-list">
              <li>Proof of Ownership (Tax Declaration, Amilyar, or Title)</li>
              <li>Floor Plan</li>
              <li>Proof of Billing (Meralco or Manila Water)</li>
              <li>Technical Description</li>
              <li>Approved Plan</li>
              <li>Authorization Letter (if applying for someone else)</li>
              <li>Xerox ID with 3 Signatures (of owner and applicant)</li>
              <li>Affidavit of House Ownership (Notary Public/Attorney)</li>
            </ul>
          </div>

          <form class="clearance-form" id="clearanceForm">
            <div class="form-field">
              <label class="form-label">Upload Signature</label>
              <div class="upload-box" id="uploadBox">
                <input type="file" id="signatureUpload" class="file-input" accept="image/*" />
                <div class="upload-instructions">
                  <svg xmlns="http://www.w3.org/2000/svg" class="upload-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M4 12l8-8 8 8M12 4v12" />
                  </svg>
                  <p>Click or drag file to this area to upload</p>
                </div>
                <div class="preview-container" id="previewContainer" style="display: none;">
                  <img id="imagePreview" src="/placeholder.svg" alt="Signature Preview" style="max-width: 100%; max-height: 200px;" />
                  <button type="button" id="removeImage" class="remove-btn">Remove</button>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <a href="../HTML/Form.html" class="btn-cancel">Back</a>
              <button type="button" id="confirmBtn" class="btn-next">Confirm</button>
            </div>
          </form>
        </section>
      </main>

      <!-- Popup Modal -->
      <div id="successPopup" class="popup">
        <div class="popup-content">
          <div class="checkmark">
            <svg width="140" height="140" viewBox="0 0 140 140" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="70" cy="70" r="65" stroke="#4CAF50" stroke-width="10"/>
              <path d="M40 70L60 90L100 50" stroke="#4CAF50" stroke-width="10" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <h2 style="font-size: 36px; margin-bottom: 20px;">Successfully submitted!</h2>
          <p style="font-size: 20px; margin-bottom: 10px;">Your Reference No. is</p>
          <p id="refNumberDisplay" style="font-size: 32px; font-weight: bold; margin-bottom: 20px;">#00001</p>
          <p style="font-size: 20px; margin-bottom: 10px;">Track your request <a id="trackLink" href="trackmyrequest.html" style="color: #4285F4; text-decoration: underline;">here</a></p>
          <button id="homeBtn">Back to Home</button>
        </div>
      </div>

      <footer class="main-footer">
        <div class="footer-content">
          <h2 class="footer-title">Barangay North Signal Village</h2>
          <p class="footer-address">
            Ipil-Ipil St, North Signal Village, Taguig 1636, Philippines
          </p>
          <div class="footer-contact">
            <p>Phone: 8-983-92-98</p>
            <p>Email: northsignalvillage.taguig@gmail.com</p>
          </div>
        </div>
        <div class="footer-logos">
          <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/c13c9fac2b848256866af925559c53806507e34f" alt="Logo 1" class="footer-logo" />
          <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/ce17a13d946f45d4463799aecacbd180eeb462fe" alt="Logo 2" class="footer-logo" />
        </div>
      </footer>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const confirmBtn = document.getElementById("confirmBtn");
        const successPopup = document.getElementById("successPopup");
        const homeBtn = document.getElementById("homeBtn");
        const signatureUpload = document.getElementById("signatureUpload");
        const previewContainer = document.getElementById("previewContainer");
        const imagePreview = document.getElementById("imagePreview");
        const uploadInstructions = document.querySelector(".upload-instructions");
        const removeImageBtn = document.getElementById("removeImage");
        const trackLink = document.getElementById("trackLink");
        const refNumberDisplay = document.getElementById("refNumberDisplay");

        // Handle file upload and preview
        if (signatureUpload) {
          signatureUpload.addEventListener("change", (e) => {
            if (e.target.files && e.target.files[0]) {
              const file = e.target.files[0];
              const reader = new FileReader();

              reader.onload = (e) => {
                imagePreview.src = e.target.result;
                previewContainer.style.display = "block";
                uploadInstructions.style.display = "none";
              };

              reader.readAsDataURL(file);
            }
          });
        }

        // Remove uploaded image
        if (removeImageBtn) {
          removeImageBtn.addEventListener("click", () => {
            signatureUpload.value = "";
            imagePreview.src = "";
            previewContainer.style.display = "none";
            uploadInstructions.style.display = "block";
          });
        }

        // Show popup when confirm button is clicked
        if (confirmBtn && successPopup) {
          confirmBtn.addEventListener("click", (e) => {
            e.preventDefault();

            // Check if signature is uploaded
            if (signatureUpload && signatureUpload.files && signatureUpload.files[0]) {
              // Generate a longer unique reference number (9 digits)
              const refNumber = "#" + Math.floor(100000000 + Math.random() * 900000000);
              console.log("Generated reference number:", refNumber);

              // Save the document request to localStorage
              const documentRequests = JSON.parse(localStorage.getItem("documentRequests")) || {};

              // Get form data from previous steps (stored in localStorage)
              const formData = JSON.parse(localStorage.getItem("formData")) || {};
              console.log("Form data:", formData);

              // Get the document type and purpose from localStorage
              const documentType = localStorage.getItem("documentType") || "Barangay Clearance";
              const documentPurpose = localStorage.getItem("documentPurpose") || "General Purpose";

              // Create applicant name from form data
              let applicantName = "Resident";
              if (formData.firstName) {
                applicantName = formData.firstName;
                if (formData.middleInitial) {
                  applicantName += " " + formData.middleInitial;
                }
                if (formData.lastName) {
                  applicantName += " " + formData.lastName;
                }
              }
              console.log("Applicant name:", applicantName);

              // Create a new document request
              documentRequests[refNumber] = {
                id: refNumber,
                type: documentType,
                purpose: documentPurpose,
                status: "Document Verification",
                dateRequested: new Date().toLocaleDateString(),
                estimatedCompletion: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toLocaleDateString(),
                applicantName: applicantName,
                formData: formData,
              };

              // Save to localStorage
              localStorage.setItem("documentRequests", JSON.stringify(documentRequests));
              console.log("Saved document requests:", documentRequests);

              // Display the reference number in the success popup
              if (refNumberDisplay) {
                refNumberDisplay.textContent = refNumber;
                console.log("Updated refNumberDisplay with:", refNumber);
              }

              // Update the track link to include the reference number
              if (trackLink) {
                trackLink.href = `trackmyrequest.html?ref=${refNumber}`;
                console.log("Updated trackLink href to:", trackLink.href);
              }

              // Show the success popup
              successPopup.style.display = "flex";
            } else if (signatureUpload) {
              alert("Please upload your signature before confirming.");
            }
          });
        }

        // Close popup and redirect when home button is clicked
        if (homeBtn) {
          homeBtn.addEventListener("click", () => {
            // Add fade-out animation
            successPopup.classList.add("fade-out");

            // Wait for animation to complete before redirecting
            setTimeout(() => {
              successPopup.style.display = "none";
              window.location.href = "../HTML/SHome.html";
            }, 500);
          });
        }
      });
    </script>
  </body>
</html>
